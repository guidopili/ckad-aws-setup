- name: Update all
  hosts: all
  become: yes
  tasks:
    - name: Ensure all to latest 
      apt:
        name: "*"
        state: latest
    - name: Adds GCE key
      apt_key:
        url: "https://packages.cloud.google.com/apt/doc/apt-key.gpg" 
        state: present
    - name: Adds repository
      apt_repository:
        repo: deb http://apt.kubernetes.io/ kubernetes-xenial main
        state: present
        filename: kubernetes
    - name: Install packages
      apt:
        pkg:
          - kubeadm=1.20.1-00
          - kubelet=1.20.1-00
          - kubectl=1.20.1-00
    - name: Hold kubeadm
      dpkg_selections:
        name: kubeadm
        selection: hold
    - name: Hold kubelet
      dpkg_selections:
        name: kubelet
        selection: hold
    - name: Hold kubectl
      dpkg_selections:
        name: kubectl
        selection: hold
